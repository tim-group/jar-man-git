[![Build Status](https://travis-ci.org/tim-group/jar-man-git.svg?branch=master)](https://travis-ci.org/tim-group/jar-man-git)

# JarManGit
I believe we have a general problem of traceability for the artifacts that we produce. The version numbers of our jars (both library jars and executable production jars) are generated by jenkins, and this gives a poor indication of the source code that they contain.

In order to address this problem, I have written two plugins, one for sbt and one for gradle. These plugins make a small change to the artifact generation stage so that both the pom.xml and the jar’s manifest get additional metadata indicating the git repo and git hash against which they were built.

This repo contains build tool plugins that will do two things:

1) include the following tags in the Jar **META-INF/MANIFEST.MF**
```text
  Git-Origin: git@git.net.local:coolproject
  Git-Repo-Is-Clean: false
  Git-Branch: master
  Git-Head-Rev: b178b10c259bb1442bcf27012c305a50c26796a2
```

2) include the following section in the **pom.xml**
```xml
  <scm>
    <url>git@git.net.local:coolproject</url>
    <tag>b178b10c259bb1442bcf27012c305a50c26796a2</tag>
  </scm>
```

Once we add the plugins to our builds, we will start to build up a record of which commits make it into which artifacts. With this information available consistently, in a machine-readable way, we can start to build tools that will improve transparency.

## Instructions for adding the plugin to your builds

### Gradle
[example](http://git.net.local/gitweb/?p=adminscreens.git;a=commitdiff;h=77497b3c5dd12a165e6c0bc9c1744553e4686f8f)

Add the “apply plugin” line to the top of your build.gradle, and add the dependency to the section at the bottom of your build.gradle.

```groovy
  apply plugin: 'jarmangit'
```

```groovy
  dependencies {
        classpath group: 'com.timgroup', name: 'gradle-jarmangit', version: "1.0.+"
  }
```

### SBT
[example](http://git.net.local/gitweb/?p=mysql-eventstore.git;a=commitdiff;h=d6cf5c23f005ba6ba9e34d5ff6e038646f94532f)

Create a new file (sbt-jarmangit.sbt) in the project directory, with the following content:

```scala
  addSbtPlugin("com.timgroup" % "sbt-jarmangit" % "1.0.14")
```
